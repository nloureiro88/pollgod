<div class="poll-list">
  <% @polls.each do |poll| %>

    <% sponsored = poll.qtype == 'sponsored' %>
    <% cat_color = poll.category.color %>

    <div class="poll-card" style="color: <%= cat_color %>">

      <i class="fas fa-ellipsis-h"></i>

      <% frame_style = sponsored ? "border-color: #{cat_color}; background-color: #{cat_color}; color: white" : "border-color: #{cat_color}" %>
      <div class="poll-frame" style="<%= frame_style %>" >

        <div class="poll-question">

          <div class="question-top">
            <div class="question-top-left">
              <% image_type = sponsored ? "category_white" : "category_color" %>
              <%= image_tag("#{image_type}/#{poll.category.icon}") %>
              <p><strong><%= "#{poll.points}" %></strong> <%= "#{poll.points == 1 ? "ticket" : "tickets"}" %></p>
            </div>
            <div class="question-top-right">
              <%= image_tag("#{poll.user.photo}", size: "36x36", class: "svg-icon", alt: "#{poll.user.first_name} #{poll.user.last_name}") %>
            </div>
          </div>

          <div class="question-main">
            <h4><%= poll.question %></h4>
          </div>

          <div class="question-buttons">
            <% btn_color = sponsored ? 'white' : cat_color %>
            <% if poll.qtype != "sponsored" && Answer.where(user: current_user, poll: poll, status: 'active').count.zero?  %>
              <%= link_to "#", class: "btn btn-pg-skip", style: "border-color: #{btn_color}; color: #{btn_color}" do %>
                <p>Skip</p>
              <% end %>
            <% end %>

            <% if Answer.where(user: current_user, poll: poll, status: 'active').count.positive? %>
              <%= link_to "#", class: "btn btn-pg-click", style: "border-color: #{btn_color}; color: #{btn_color}" do %>
                <p>Results</p>
              <% end %>
            <% else %>
              <%= link_to "#", class: "btn btn-pg-click", style: "border-color: #{btn_color}; color: #{ sponsored ? cat_color : 'white'}; background-color: #{btn_color}" do %>
                <p>Answer</p>
              <% end %>
            <% end %>
          </div>

        </div>
      </div>

      <% poll_count = poll.answers.where(status: 'active').count %>
      <% poll_likes = poll.like_count %>
      <% poll_hash = poll.like_hash %>

      <div class="poll-bottom">
        <div class="poll-bottom-left">
          <p>
            <strong><%= poll.qtype.downcase.capitalize %></strong>
          </p>
          <p>
            <%= poll.deadline.strftime("%d/%m %H:%M") %>
          </p>
        </div>

        <div class="poll-bottom-right">
          <p>
            <%= poll_count %> answers
            <span> : </span>
            <%= poll.like_count %> points
          </p>
          <p class="lighter">
            <i class="fas fa-heart"></i> <%= ((poll_hash[:love] / poll_count.to_f).round(2) * 100).to_i %>%
            <i class="fas fa-grin-squint"></i> <%= ((poll_hash[:funny] / poll_count.to_f).round(2) * 100).to_i %>%
            <i class="fas fa-graduation-cap"></i> <%= ((poll_hash[:interest] / poll_count.to_f).round(2) * 100).to_i %>%
          </p>
        </div>
      </div>

    </div>
  <% end %>
</div>
